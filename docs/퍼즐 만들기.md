좋습니다. `PuzzleBoardFactory`의 격자 생성 알고리즘은 **난이도와 게임의 재미**를 결정하는 핵심입니다. 현재의 알고리즘을 상세히 분석하고, 발생 가능한 문제를 해결하며, **실제 플레이어 경험을 최적화**하는 방향으로 연구하겠습니다.

* * *

PuzzleBoardFactory 알고리즘 상세 연구 ⚙️
--------------------------------

현재 알고리즘은 크게 **데이터 확보**, **훼방 글자 생성**, **최종 배열**의 3단계로 이루어져 있습니다. 이 중 **훼방 글자 생성 로직**과 **글자 수량 조절** 부분에 대해 깊이 있는 분석과 개선안을 제시합니다.

### 1\. 데이터 확보 및 수량 조절 (개선 필요)

**목표:** `correctLetters` 리스트의 글자 수가 정확히 **정답 비율**을 만족하도록 확보합니다.

| 현재 로직        | 문제점                                                                                          | 개선 방안                                                                                                     |
| ------------ | -------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- |
| **단순 복제**    | 정답 글자가 부족할 때 **가장 빈번한 글자**를 복제합니다. 이는 특정 글자('이', '가' 등)의 밀도를 비정상적으로 높여 게임의 패턴을 예측 가능하게 만듭니다. | **난이도 기반 복제** 또는 **무작위 보충**을 통해 특정 글자의 과도한 집중을 막고, **희귀한 글자** 위주로 보충하여 난이도를 미세하게 조절합니다.                   |
| **정답 비율 고정** | 정답 비율을 75%로 고정했습니다.                                                                          | **난이도 시스템 연동:** `Words` 테이블의 `diff` 값이나 선택된 카테고리에 따라 이 비율을 동적으로 변경하여, 난이도가 높은 카테고리는 정답 비율을 낮춥니다 (예: 60%). |
|              |                                                                                              |                                                                                                           |
|              |                                                                                              |                                                                                                           |

Sheets로 내보내기

### 2\. 훼방 글자 생성 (`_generateDummyLetters`) (가장 큰 문제) ⚠️

**현재 문제점:** 훼방 글자 후보군(`dummyCandidates`)이 너무 제한적입니다 (`'아', '이', '에', '요' 등 14개 내외`).

1.  **후보군의 고갈:** 게임이 여러 번 반복되면 훼방 글자가 항상 똑같은 패턴으로 등장하여 지루함을 유발합니다.
    
2.  **정답 중복 가능성:** 후보군에서 정답에 쓰인 글자를 제외하는 로직이 있으나, 후보군 자체가 좁으면 훼방 글자의 패턴이 곧 노출됩니다.
    

**개선 방안: 통합 훼방 글자 생성**

훼방 글자를 생성하는 로직을 **두 가지 레벨**로 분리하여 난이도를 조절해야 합니다.

| 레벨 | 설명 | 목적 |
| --- | --- | --- |
| **레벨 1 (쉬움/일반)** | 자주 사용되는 **조사/어미**(`'가', '는', '다'`) 등 단어의 연결성을 높이지만, 정답이 될 확률이 낮은 글자를 사용합니다. (현재 방식과 유사) | 단어를 찾기 쉽게 만들어 게임의 기본 재미를 보장합니다. |
| **레벨 2 (어려움/혼란)** | **이번 카테고리의 정답 단어에는 없지만**, 다른 카테고리의 단어에 사용될 수 있는 **일반 명사 글자**를 사용합니다. | 난이도를 높입니다. (예: '동물' 카테고리 게임 시, '음식' 카테고리의 글자 '밥', '국' 등을 훼방 글자로 사용) |

Sheets로 내보내기

### 3\. 최종 배열 및 구현 최적화

**문제:** 현재 `_generateDummyLetters` 함수는 훼방 글자가 정답 글자에 포함되는지 확인하기 위해 \*\*`do-while` 루프와 `maxAttempts`\*\*를 사용합니다.

**개선:** 루프 대신 **Set 연산**을 사용하여 중복 확인 로직을 간소화하고 명확하게 만들어야 합니다.

Dart

```dart
// 개선된 훼방 글자 생성 로직 (Set 연산을 활용)

final Set<String> allCandidates = {...dummyCandidates}; // 모든 후보 글자
final Set<String> lettersToExclude = validWords.expand((word) => word.split('')).toSet(); // 정답에 사용된 글자

// 1. 후보 글자에서 정답에 사용된 글자를 제외합니다.
final availableCandidates = allCandidates.difference(lettersToExclude).toList();

// 2. 제외 후 남은 후보군에서 필요한 개수만큼 무작위 추출합니다.
final Random random = Random();
final List<String> dummyLetters = [];

for (int i = 0; i < targetDummyCount; i++) {
    if (availableCandidates.isNotEmpty) {
        final index = random.nextInt(availableCandidates.length);
        dummyLetters.add(availableCandidates[index]);
    } else {
        // 후보군이 모두 소진되었다면, '?' 등 특수 글자로 채웁니다. (안전 장치)
        dummyLetters.add('?'); 
    }
}
return dummyLetters;

```

**결론:** 명시적인 **Set 연산**을 사용하면 `do-while` 루프를 제거하고, 코드를 **더 빠르고 안정적이며** 예측 가능하게 만들 수 있습니다. 이 개선된 로직을 `PuzzleBoardFactory`에 적용하여 안정성을 극대화해야 합니다.

어떤 개선 로직(난이도 동적 조절, 훼방 글자 다양화)에 대해 코드를 먼저 보고 싶으신가요?